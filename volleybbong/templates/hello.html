<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>사용자 입력</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
        // 경기년도/월 불러오기
        $(document).ready(function() {
            $.ajax({
                type: "GET",
                url: "/month",
                success: function(response) {
                    console.log(response);
                    for(var i=0; i<response.length; i++) {
                        optionMonth(response[i])
                    }
                }
            })
        });
        function optionMonth(insertValue) {
            let monthHtml = '<option value="'+insertValue+'">'+insertValue+'</option>';
            $('#gameMonth').append(monthHtml);
        }

        // 경기년도에 해당하는 경기번호 불러오기
        $(document).on("change", "#gameMonth", function() {
            var gameMonthVal = $('#gameMonth').val();
            $('#gameNum').html('<option>경기번호</option>');
            $.ajax({
                type:"POST",
                url: "/number",
                data: { month: gameMonthVal },
                success: function(response) {

                    console.log(response)
                    if(response["result"] == "success") {
                        alert('경기번호를 불러왔습니다.');
                        console.log(response["msg"]);
                        for(var i=0; i<response["msg"].length; i++) {
                            optionNumber(response["msg"][i])
                        }
                    } else {
                        alert(response["msg"]);
                    }
                }
            })
		});
		function optionNumber(insertValue) {
		    let numberHtml = '<option value="'+insertValue+'">'+insertValue+'</option>';
		    $('#gameNum').append(numberHtml);
		}

		// 경기번호에 해당하는 배구팀 불러오기
		$(document).on("change", "#gameNum", function() {
		    var gameMonthVal = $('#gameMonth').val();
            var gameNumVal = $('#gameNum').val();
            $('#gameTeam').html('<option>배구팀</option>');
            $.ajax({
                type:"POST",
                url: "/team",
                data: { month: gameMonthVal, number: gameNumVal },
                success: function(response) {
                    console.log(response)
                    if(response["result"] == "success") {
                        alert('경기팀을 불러왔습니다.');
                        console.log(response["msg"]);
                        for(var i=0; i<response["msg"].length; i++) {
                            optionTeam(response["msg"][i])
                        }
                    } else {
                        alert(response["msg"]);
                    }
                }
            })
		});
        function optionTeam(insertValue) {
		    let teamHtml = '<option value="'+insertValue+'">'+insertValue+'</option>';
		    $('#gameTeam').append(teamHtml);
		}

		// 배구팀에 해당하는 선수 불러오기
		$(document).on("change", "#gameTeam", function() {
		    var gameMonthVal = $('#gameMonth').val();
            var gameNumVal = $('#gameNum').val();
            var gameTeamVal = $('#gameTeam').val();
            $('#gamePlayer').html('<option>배구선수</option>');
            $.ajax({
                type:"POST",
                url: "/player",
                data: { month: gameMonthVal, number: gameNumVal, team: gameTeamVal },
                success: function(response) {
                    alert('선수를 불러왔습니다.');
                    console.log(response)
                    for(var i=0; i<response.length; i++) {
                        optionPlayer(response[i])
                    }
                }
            })
		})
        function optionPlayer(insertValue) {
		    let playerHtml = '<option value="'+insertValue+'">'+insertValue+'</option>';
		    $('#gamePlayer').append(playerHtml);
		}

        // 최종 데이터 요청
		function register() {
            var gameMonthVal = $('#gameMonth').val();
            var gameNumVal = $('#gameNum').val();
            var gameTeamVal = $('#gameTeam').val();
            var gamePlayerVal = $('#gamePlayer').val();

            $.ajax({
                type: "POST",
                url: "/volley",
                data: {
                        gameMonth: gameMonthVal,
                        gameNum: gameNumVal,
                        gameTeam: gameTeamVal,
                        gamePlayer: gamePlayerVal
                    },
                success: function(response) {
                    alert('선수의 기록을 불러왔습니다.');
                    console.log(response)
                    $('.position_wrap').html('');
                    allInfo(
                        response['pt1T_list'], response['pt1F_list'], response['pt1Margin'],
                        response['pt2T_list'], response['pt2F_list'], response['pt2Margin'],
                        response['pt3T_list'], response['pt3F_list'], response['pt3Margin'],
                        response['pt4T_list'], response['pt4F_list'], response['pt4Margin'],
                        response['pt5T_list'], response['pt5F_list'], response['pt5Margin'],
                        response['pt6T_list'], response['pt6F_list'], response['pt6Margin']
                    )
                }
            })
        }
        function allInfo(pt1T_list, pt1F_list, pt1Margin,
                         pt2T_list, pt2F_list, pt2Margin,
                         pt3T_list, pt3F_list, pt3Margin,
                         pt4T_list, pt4F_list, pt4Margin,
                         pt5T_list, pt5F_list, pt5Margin,
                         pt6T_list, pt6F_list, pt6Margin) {
            let infoHtml = '<div class="position_box position04">\
                                <h3 class="title">Position 4</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt4T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt4F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt4Margin+'</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position4.png"></div>\
                            </div>\
                            <div class="position_box position03">\
                                <h3 class="title">Position 3</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt3T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt3F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt3Margin+'</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position3.png"></div>\
                            </div>\
                            <div class="position_box position02">\
                                <h3 class="title">Position 2</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt2T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt2F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt2Margin+'</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position2.png"></div>\
                            </div>\
                            <div class="position_box not_position">\
                                <h3 class="title">Not Position</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">27점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">27점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">8</span></p>\
                                </div>\
                            </div>\
                            <div class="position_box position05">\
                                <h3 class="title">Position 5</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt5T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt5F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt5Margin+'</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position5.png"></div>\
                            </div>\
                            <div class="position_box position06">\
                                <h3 class="title">Position 6</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt6T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt6F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt6Margin+'</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position6.png"></div>\
                            </div>\
                            <div class="position_box position01">\
                                <h3 class="title">Position 1</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">'+pt1T_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">'+pt1F_list+'점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">8</span></p>\
                                </div>\
                                <div class="img_box"><img src="../static/images/position1.png"></div>\
                            </div>\
                            <div class="position_box all_position">\
                                <h3 class="title">All Position</h3>\
                                <div class="score_box">\
                                    <p class="success">득점 : <span class="score">27점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="fail">실점 : <span class="score">27점</span> (<span class="percent">36%</span>)</p>\
                                    <p class="margin">마진 : <span class="margin_score">'+pt1Margin+'</span></p>\
                                </div>\
                                <p class="result">Result : <span class="result_text">WIN</span></p>\
                            </div>';
            $('.position_wrap').append(infoHtml);
        }
    </script>
</head>
<body>
<div class="wrapper">
	<div class="container">

		<!-- 타이틀 영역 -->
		<div class="title_wrap">
			<h1>volleybbong</h1>
			<p>women’s volleyball</p>
		</div>

		<!-- select 영역 -->
		<div class="select_wrap">
			<div class="select_box">
				<select id="gameMonth">
					<option>경기날짜</option>
				</select>
				<select id="gameNum">
					<option>경기번호</option>
				</select>
				<select id="gameTeam">
					<option>배구팀</option>
				</select>
				<select id="gamePlayer">
					<option>배구선수</option>
				</select>
			</div>
			<div class="select_submit">
				<button type="button" onclick="register()">전송</button>
			</div>
		</div>

		<!-- 포지션 영역 -->
		<div class="position_wrap">

		</div>
	</div>
</div>
</body>
</html>